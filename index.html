<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>P3 Materials Interactive Quiz</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f8fc; padding: 2rem; color: #333; margin-top: 70px; /* Space for fixed nav */ }
    h1 { color: #2c3e50; text-align: center; margin-bottom: 1rem; font-size: 1.8em; }
    h2 { color: #34495e; margin-top: 0; font-size: 1.2em; }
    .quiz-section { display: none; padding-top: 1rem; }
    .quiz-section.active { display: block; }
    .question { background: #fff; padding: 1rem; margin-bottom: 1rem; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .question input[type="text"], .question select { width: calc(100% - 12px); padding: 8px; margin-top: 5px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; font-size: 0.9em;}
    .question input[type="radio"] { margin-right: 5px; vertical-align: middle;}
    .question label { vertical-align: middle; }
    .feedback { margin-top: 0.5rem; padding: 0.5rem; border-radius: 4px; font-weight: bold; font-size: 0.9em;}
    .feedback.correct { color: #27ae60; background-color: #e9f7ef; border-left: 4px solid #27ae60; }
    .feedback.incorrect { color: #c0392b; background-color: #fdedec; border-left: 4px solid #c0392b;}
    .feedback.info { color: #2980b9; background-color: #eaf2f8; border-left: 4px solid #2980b9; }
    .loading { color: #2980b9; font-style: italic; }
    button.quiz-submit-btn { display: block; width: 180px; margin: 1.5rem auto 1rem; padding: 0.7rem 1.2rem; background: #3498db; color: white; border: none; border-radius: 5px; font-size: 1rem; cursor: pointer; transition: background-color 0.3s ease; }
    button.quiz-submit-btn:hover { background: #2980b9; }
    .result { font-weight: bold; margin-top: 1.5rem; font-size: 1.1rem; text-align: center; padding: 0.8rem; background-color: #e8f6fd; border: 1px solid #3498db; border-radius: 5px; color: #2c3e50; }
    .navigation-buttons { position: fixed; top: 10px; right: 10px; z-index: 1000; background-color: rgba(255, 255, 255, 0.95); padding: 8px; border-radius: 5px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .navigation-buttons button { margin-left: 5px; padding: 8px 12px; cursor: pointer; border: 1px solid #ccc; background-color: #f0f0f0; border-radius: 3px; font-size: 0.9em; }
    .navigation-buttons button.active-nav { background-color: #3498db; color: white; border-color: #2980b9; }
  </style>
</head>
<body>

  <div class="navigation-buttons">
    <button onclick="showQuiz('quizSet1')" id="navBtnSet1">Main Quiz</button>
    <button onclick="showQuiz('quizSet2')" id="navBtnSet2">Revision Set 2</button>
    <button onclick="showQuiz('quizSet3')" id="navBtnSet3">Revision Set 3</button>
  </div>

  <!-- QUIZ SET 1: Main Diversity of Materials Quiz -->
  <div id="quizSet1" class="quiz-section">
    <h1>P3 Diversity of Materials – Main Quiz</h1>
    <form id="quizFormSet1">
      <!-- MCQ Questions: 5 (q1_1 to q1_5) -->
      <div class="question"><h2>1. Which material is most suitable for a raincoat?</h2><input type="radio" name="q1_1" value="A" id="q1_1A"><label for="q1_1A"> A. Paper</label><br/><input type="radio" name="q1_1" value="B" id="q1_1B"><label for="q1_1B"> B. Cotton</label><br/><input type="radio" name="q1_1" value="C" id="q1_1C"><label for="q1_1C"> C. Plastic</label><br/><input type="radio" name="q1_1" value="D" id="q1_1D"><label for="q1_1D"> D. Glass</label><div class="feedback" id="f1_1"></div></div>
      <div class="question"><h2>2. Which property is most important for making windows?</h2><input type="radio" name="q1_2" value="A" id="q1_2A"><label for="q1_2A"> A. Flexibility</label><br/><input type="radio" name="q1_2" value="B" id="q1_2B"><label for="q1_2B"> B. Waterproof</label><br/><input type="radio" name="q1_2" value="C" id="q1_2C"><label for="q1_2C"> C. Softness</label><br/><input type="radio" name="q1_2" value="D" id="q1_2D"><label for="q1_2D"> D. Transparency</label><div class="feedback" id="f1_2"></div></div>
      <div class="question"><h2>3. Which of the following is a flexible material?</h2><input type="radio" name="q1_3" value="A" id="q1_3A"><label for="q1_3A"> A. Glass</label><br/><input type="radio" name="q1_3" value="B" id="q1_3B"><label for="q1_3B"> B. Metal</label><br/><input type="radio" name="q1_3" value="C" id="q1_3C"><label for="q1_3C"> C. Rubber</label><br/><input type="radio" name="q1_3" value="D" id="q1_3D"><label for="q1_3D"> D. Wood</label><div class="feedback" id="f1_3"></div></div>
      <div class="question"><h2>4. Why is wood used to make tables?</h2><input type="radio" name="q1_4" value="A" id="q1_4A"><label for="q1_4A"> A. It is soft</label><br/><input type="radio" name="q1_4" value="B" id="q1_4B"><label for="q1_4B"> B. It is strong and hard</label><br/><input type="radio" name="q1_4" value="C" id="q1_4C"><label for="q1_4C"> C. It is transparent</label><br/><input type="radio" name="q1_4" value="D" id="q1_4D"><label for="q1_4D"> D. It is flexible</label><div class="feedback" id="f1_4"></div></div>
      <div class="question"><h2>5. What is the main reason plastic is used for water bottles?</h2><input type="radio" name="q1_5" value="A" id="q1_5A"><label for="q1_5A"> A. It is soft</label><br/><input type="radio" name="q1_5" value="B" id="q1_5B"><label for="q1_5B"> B. It is expensive</label><br/><input type="radio" name="q1_5" value="C" id="q1_5C"><label for="q1_5C"> C. It is waterproof</label><br/><input type="radio" name="q1_5" value="D" id="q1_5D"><label for="q1_5D"> D. It breaks easily</label><div class="feedback" id="f1_5"></div></div>
      <!-- Fill in the Blanks: 5 (q1_6 to q1_10) -->
      <div class="question"><h2>6. A rubber band has __________ because it can stretch and return to its shape.</h2><input type="text" name="q1_6"/><div class="feedback" id="f1_6"></div></div>
      <div class="question"><h2>7. Glass is __________, so we can see through it.</h2><input type="text" name="q1_7"/><div class="feedback" id="f1_7"></div></div>
      <div class="question"><h2>8. Metal is __________ and can be used to build bridges.</h2><input type="text" name="q1_8"/><div class="feedback" id="f1_8"></div></div>
      <div class="question"><h2>9. Most water bottles are made of __________ because it is waterproof.</h2><input type="text" name="q1_9"/><div class="feedback" id="f1_9"></div></div>
      <div class="question"><h2>10. Metal is __________ than plastic. (Hint: think about how heavy they are)</h2><input type="text" name="q1_10"/><div class="feedback" id="f1_10"></div></div>
      <!-- Short Answer: 5 (q1_11 to q1_15) -->
      <div class="question"><h2>11. Why is metal used to make the frame of a bicycle?</h2><input type="text" name="q1_11"/><div class="feedback" id="f1_11"></div></div>
      <div class="question"><h2>12. Name one object that should be made from flexible material. Why?</h2><input type="text" name="q1_12"/><div class="feedback" id="f1_12"></div></div>
      <div class="question"><h2>13. Explain why fabric is not suitable for making a swimming cap.</h2><input type="text" name="q1_13"/><div class="feedback" id="f1_13"></div></div>
      <div class="question"><h2>14. How do we test if a material is waterproof?</h2><input type="text" name="q1_14"/><div class="feedback" id="f1_14"></div></div>
      <div class="question"><h2>15. Why is it important to compare the properties of materials before using them?</h2><input type="text" name="q1_15"/><div class="feedback" id="f1_15"></div></div>
      <!-- Matching: 1 with 4 items (q1_16) -->
      <div class="question"><h2>16. Match the materials with their main properties.</h2>
        Rubber: <select name="q1_16_rubber"><option value="">--Select--</option><option value="A">Transparent</option><option value="B">Flexible</option><option value="C">Strong</option><option value="D">Soft</option></select><br/><br/>
        Metal: <select name="q1_16_metal"><option value="">--Select--</option><option value="A">Transparent</option><option value="B">Flexible</option><option value="C">Strong</option><option value="D">Soft</option></select><br/><br/>
        Glass: <select name="q1_16_glass"><option value="">--Select--</option><option value="A">Transparent</option><option value="B">Flexible</option><option value="C">Strong</option><option value="D">Soft</option></select><br/><br/>
        Fabric: <select name="q1_16_fabric"><option value="">--Select--</option><option value="A">Transparent</option><option value="B">Flexible</option><option value="C">Strong</option><option value="D">Soft</option></select>
        <div class="feedback" id="f1_16"></div>
      </div>
      <button type="button" class="quiz-submit-btn" onclick="submitQuiz('quizSet1')">Submit Main Quiz</button>
      <div class="result" id="resultsSet1"></div>
    </form>
  </div>

  <!-- QUIZ SET 2: Revision Set 2 -->
  <div id="quizSet2" class="quiz-section">
    <h1>P3 Materials – Revision Set 2: Definitions & Properties</h1>
    <form id="quizFormSet2">
      <!-- MCQ: 5 (q2_1 to q2_5) -->
      <div class="question"><h2>1. The ability of a material to be subjected to loads without breaking is its:</h2><input type="radio" name="q2_1" value="A" id="q2_1A"><label for="q2_1A"> A. Flexibility</label><br/><input type="radio" name="q2_1" value="B" id="q2_1B"><label for="q2_1B"> B. Strength</label><br/><input type="radio" name="q2_1" value="C" id="q2_1C"><label for="q2_1C"> C. Transparency</label><br/><input type="radio" name="q2_1" value="D" id="q2_1D"><label for="q2_1D"> D. Waterproofness</label><div class="feedback" id="f2_1"></div></div>
      <div class="question"><h2>2. Which material is known for its excellent transparency?</h2><input type="radio" name="q2_2" value="A" id="q2_2A"><label for="q2_2A"> A. Wood</label><br/><input type="radio" name="q2_2" value="B" id="q2_2B"><label for="q2_2B"> B. Metal</label><br/><input type="radio" name="q2_2" value="C" id="q2_2C"><label for="q2_2C"> C. Glass</label><br/><input type="radio" name="q2_2" value="D" id="q2_2D"><label for="q2_2D"> D. Rubber</label><div class="feedback" id="f2_2"></div></div>
      <div class="question"><h2>3. A material that can bend easily without breaking is:</h2><input type="radio" name="q2_3" value="A" id="q2_3A"><label for="q2_3A"> A. Hard</label><br/><input type="radio" name="q2_3" value="B" id="q2_3B"><label for="q2_3B"> B. Strong</label><br/><input type="radio" name="q2_3" value="C" id="q2_3C"><label for="q2_3C"> C. Flexible</label><br/><input type="radio" name="q2_3" value="D" id="q2_3D"><label for="q2_3D"> D. Brittle</label><div class="feedback" id="f2_3"></div></div>
      <div class="question"><h2>4. If an object does not absorb water, it is considered:</h2><input type="radio" name="q2_4" value="A" id="q2_4A"><label for="q2_4A"> A. Transparent</label><br/><input type="radio" name="q2_4" value="B" id="q2_4B"><label for="q2_4B"> B. Strong</label><br/><input type="radio" name="q2_4" value="C" id="q2_4C"><label for="q2_4C"> C. Waterproof</label><br/><input type="radio" name="q2_4" value="D" id="q2_4D"><label for="q2_4D"> D. Flexible</label><div class="feedback" id="f2_4"></div></div>
      <div class="question"><h2>5. The ability to float on water means an object can:</h2><input type="radio" name="q2_5" value="A" id="q2_5A"><label for="q2_5A"> A. Stay on or near the surface of water.</label><br/><input type="radio" name="q2_5" value="B" id="q2_5B"><label for="q2_5B"> B. Absorb a lot of water.</label><br/><input type="radio" name="q2_5" value="C" id="q2_5C"><label for="q2_5C"> C. Bend easily.</label><br/><input type="radio" name="q2_5" value="D" id="q2_5D"><label for="q2_5D"> D. Be seen through clearly.</label><div class="feedback" id="f2_5"></div></div>
      <!-- FIB: 5 (q2_6 to q2_10) -->
      <div class="question"><h2>6. The "strength" of a material refers to its ability to be subjected to _________ without breaking.</h2><input type="text" name="q2_6"/><div class="feedback" id="f2_6"></div></div>
      <div class="question"><h2>7. "Flexibility" is a material's ability to _________ without breaking.</h2><input type="text" name="q2_7"/><div class="feedback" id="f2_7"></div></div>
      <div class="question"><h2>8. An object that stays on or near the surface of water shows the ability to _________.</h2><input type="text" name="q2_8"/><div class="feedback" id="f2_8"></div></div>
      <div class="question"><h2>9. A material is "waterproof" when it does not _________ water.</h2><input type="text" name="q2_9"/><div class="feedback" id="f2_9"></div></div>
      <div class="question"><h2>10. "Transparency" refers to whether a material allows most/some or no _________ to pass through.</h2><input type="text" name="q2_10"/><div class="feedback" id="f2_10"></div></div>
      <!-- Short Answer: 5 (q2_11 to q2_15) -->
      <div class="question"><h2>11. Describe "strength" in your own words using an example.</h2><input type="text" name="q2_11"/><div class="feedback" id="f2_11"></div></div>
      <div class="question"><h2>12. What is "flexibility"? Give an example of a flexible material.</h2><input type="text" name="q2_12"/><div class="feedback" id="f2_12"></div></div>
      <div class="question"><h2>13. How would you know if a material is "waterproof"?</h2><input type="text" name="q2_13"/><div class="feedback" id="f2_13"></div></div>
      <div class="question"><h2>14. Explain "transparency" and give an example of a transparent object.</h2><input type="text" name="q2_14"/><div class="feedback" id="f2_14"></div></div>
      <div class="question"><h2>15. Why is it important to know if a material can float or sink for certain objects?</h2><input type="text" name="q2_15"/><div class="feedback" id="f2_15"></div></div>
      <!-- Matching: 1 with 4 items (q2_16) -->
      <div class="question"><h2>16. Match the property with its definition focus.</h2>
        Strength: <select name="q2_16_strength"><option value="">--Select--</option><option value="A">Bending</option><option value="B">Water absorption</option><option value="C">Loads/Breaking</option><option value="D">Light passing</option></select><br/><br/>
        Flexibility: <select name="q2_16_flexibility"><option value="">--Select--</option><option value="A">Bending</option><option value="B">Water absorption</option><option value="C">Loads/Breaking</option><option value="D">Light passing</option></select><br/><br/>
        Waterproof: <select name="q2_16_waterproof"><option value="">--Select--</option><option value="A">Bending</option><option value="B">Water absorption</option><option value="C">Loads/Breaking</option><option value="D">Light passing</option></select><br/><br/>
        Transparency: <select name="q2_16_transparency"><option value="">--Select--</option><option value="A">Bending</option><option value="B">Water absorption</option><option value="C">Loads/Breaking</option><option value="D">Light passing</option></select>
        <div class="feedback" id="f2_16"></div>
      </div>
      <button type="button" class="quiz-submit-btn" onclick="submitQuiz('quizSet2')">Submit Revision Set 2</button>
      <div class="result" id="resultsSet2"></div>
    </form>
  </div>

  <!-- QUIZ SET 3: Revision Set 3 -->
  <div id="quizSet3" class="quiz-section">
    <h1>P3 Materials – Revision Set 3: Application & Uses</h1>
    <form id="quizFormSet3">
      <!-- MCQ: 5 (q3_1 to q3_5) -->
      <div class="question"><h2>1. For a bookshelf, which property is most important for the shelves?</h2><input type="radio" name="q3_1" value="A" id="q3_1A"><label for="q3_1A"> A. Transparency</label><br/><input type="radio" name="q3_1" value="B" id="q3_1B"><label for="q3_1B"> B. Flexibility</label><br/><input type="radio" name="q3_1" value="C" id="q3_1C"><label for="q3_1C"> C. Strength</label><br/><input type="radio" name="q3_1" value="D" id="q3_1D"><label for="q3_1D"> D. Ability to float</label><div class="feedback" id="f3_1"></div></div>
      <div class="question"><h2>2. An object that needs to keep you dry in the rain must be:</h2><input type="radio" name="q3_2" value="A" id="q3_2A"><label for="q3_2A"> A. Flexible</label><br/><input type="radio" name="q3_2" value="B" id="q3_2B"><label for="q3_2B"> B. Waterproof</label><br/><input type="radio" name="q3_2" value="C" id="q3_2C"><label for="q3_2C"> C. Transparent</label><br/><input type="radio" name="q3_2" value="D" id="q3_2D"><label for="q3_2D"> D. Strong</label><div class="feedback" id="f3_2"></div></div>
      <div class="question"><h2>3. Spectacle lenses are made of glass or plastic mainly because these materials are:</h2><input type="radio" name="q3_3" value="A" id="q3_3A"><label for="q3_3A"> A. Strong</label><br/><input type="radio" name="q3_3" value="B" id="q3_3B"><label for="q3_3B"> B. Waterproof</label><br/><input type="radio" name="q3_3" value="C" id="q3_3C"><label for="q3_3C"> C. Transparent</label><br/><input type="radio" name="q3_3" value="D" id="q3_3D"><label for="q3_3D"> D. Flexible</label><div class="feedback" id="f3_3"></div></div>
      <div class="question"><h2>4. A sponge is useful for cleaning spills because it is:</h2><input type="radio" name="q3_4" value="A" id="q3_4A"><label for="q3_4A"> A. Waterproof</label><br/><input type="radio" name="q3_4" value="B" id="q3_4B"><label for="q3_4B"> B. Absorbent (opposite of waterproof)</label><br/><input type="radio" name="q3_4" value="C" id="q3_4C"><label for="q3_4C"> C. Transparent</label><br/><input type="radio" name="q3_4" value="D" id="q3_4D"><label for="q3_4D"> D. Very strong</label><div class="feedback" id="f3_4"></div></div>
      <div class="question"><h2>5. Car tyres are made of rubber because rubber is:</h2><input type="radio" name="q3_5" value="A" id="q3_5A"><label for="q3_5A"> A. Transparent and hard</label><br/><input type="radio" name="q3_5" value="B" id="q3_5B"><label for="q3_5B"> B. Waterproof and absorbent</label><br/><input type="radio" name="q3_5" value="C" id="q3_5C"><label for="q3_5C"> C. Flexible and strong</label><br/><input type="radio" name="q3_5" value="D" id="q3_5D"><label for="q3_5D"> D. Soft and breaks easily</label><div class="feedback" id="f3_5"></div></div>
      <!-- FIB: 5 (q3_6 to q3_10) -->
      <div class="question"><h2>6. A boat is designed to _________ so it can carry people on water.</h2><input type="text" name="q3_6"/><div class="feedback" id="f3_6"></div></div>
      <div class="question"><h2>7. Clothes are usually made from _________ because it is soft and flexible.</h2><input type="text" name="q3_7"/><div class="feedback" id="f3_7"></div></div>
      <div class="question"><h2>8. A cooking pot is often made of metal because metal is _________ and conducts heat well.</h2><input type="text" name="q3_8"/><div class="feedback" id="f3_8"></div></div>
      <div class="question"><h2>9. To build a tall skyscraper, materials used must be very _________.</h2><input type="text" name="q3_9"/><div class="feedback" id="f3_9"></div></div>
      <div class="question"><h2>10. A plastic food container is useful because it is often _________ (so you can see inside) and waterproof.</h2><input type="text" name="q3_10"/><div class="feedback" id="f3_10"></div></div>
      <!-- Short Answer: 5 (q3_11 to q3_15) -->
      <div class="question"><h2>11. Why is fabric a good choice for making a T-shirt? Mention two properties.</h2><input type="text" name="q3_11"/><div class="feedback" id="f3_11"></div></div>
      <div class="question"><h2>12. If you were to build a strong bridge, what material property would be most important? Why?</h2><input type="text" name="q3_12"/><div class="feedback" id="f3_12"></div></div>
      <div class="question"><h2>13. Why are most toys for very young children made of plastic or fabric rather than glass or ceramic?</h2><input type="text" name="q3_13"/><div class="feedback" id="f3_13"></div></div>
      <div class="question"><h2>14. Name an object that needs to be waterproof and explain why.</h2><input type="text" name="q3_14"/><div class="feedback" id="f3_14"></div></div>
      <div class="question"><h2>15. You need to choose a material for a rope swing. What two properties would be very important?</h2><input type="text" name="q3_15"/><div class="feedback" id="f3_15"></div></div>
      <!-- Matching: 1 with 4 items (q3_16) -->
      <div class="question"><h2>16. Match the object to the primary material it's often made from.</h2>
        Window pane: <select name="q3_16_window"><option value="">--Select--</option><option value="A">Metal</option><option value="B">Rubber</option><option value="C">Fabric</option><option value="D">Glass</option></select><br/><br/>
        Car tyre: <select name="q3_16_tyre"><option value="">--Select--</option><option value="A">Metal</option><option value="B">Rubber</option><option value="C">Fabric</option><option value="D">Glass</option></select><br/><br/>
        T-shirt: <select name="q3_16_tshirt"><option value="">--Select--</option><option value="A">Metal</option><option value="B">Rubber</option><option value="C">Fabric</option><option value="D">Glass</option></select><br/><br/>
        Coins: <select name="q3_16_coins"><option value="">--Select--</option><option value="A">Metal</option><option value="B">Rubber</option><option value="C">Fabric</option><option value="D">Glass</option></select>
        <div class="feedback" id="f3_16"></div>
      </div>
      <button type="button" class="quiz-submit-btn" onclick="submitQuiz('quizSet3')">Submit Revision Set 3</button>
      <div class="result" id="resultsSet3"></div>
    </form>
  </div>

<script src="config.js"></script>
<script>
// --- Global Quiz Data ---
const allQuizData = {
  quizSet1: {
    title: "Main Quiz",
    formId: "quizFormSet1", resultsId: "resultsSet1",
    mcq: { q1_1: "C", q1_2: "D", q1_3: "C", q1_4: "B", q1_5: "C" },
    fib: { q1_6: ["flexibility","elasticity"], q1_7: ["transparent","clear"], q1_8: ["strong","hard","rigid"], q1_9: ["plastic"], q1_10: ["heavier","denser","stronger"]},
    match: { q1_16_rubber: "B", q1_16_metal: "C", q1_16_glass: "A", q1_16_fabric: "D" },
    shortAnswer: {
      q1_11: "Metal is strong, rigid, and durable, supporting weight and stress without breaking.",
      q1_12: "A rubber band. It needs to be flexible to stretch and return to shape.",
      q1_13: "Fabric absorbs water and isn't waterproof, so it won't keep hair dry.",
      q1_14: "Pour water on it. If water doesn't pass through or get absorbed, it's waterproof.",
      q1_15: "To choose the best material for the job so it works well, is safe, and lasts."
    },
    shortAnswerIds: ["q1_11", "q1_12", "q1_13", "q1_14", "q1_15"],
    totalQuestions: 19
  },
  quizSet2: {
    title: "Revision Set 2: Definitions & Properties",
    formId: "quizFormSet2", resultsId: "resultsSet2",
    mcq: { q2_1: "B", q2_2: "C", q2_3: "C", q2_4: "C", q2_5: "A"},
    fib: { q2_6: ["loads"], q2_7: ["bend"], q2_8: ["float"], q2_9: ["absorb"], q2_10: ["light"]},
    match: { q2_16_strength: "C", q2_16_flexibility: "A", q2_16_waterproof: "B", q2_16_transparency: "D" },
    shortAnswer: {
      q2_11: "Strength means a material can hold or support heavy things without breaking, like a strong metal shelf holding books.",
      q2_12: "Flexibility means a material can bend without breaking. Rubber is a flexible material.",
      q2_13: "If you put water on it and the water stays on top or runs off instead of soaking in, it's waterproof.",
      q2_14: "Transparency means you can see clearly through the material, like a clean glass window.",
      q2_15: "For a boat, it needs to float. For an anchor, it needs to sink to hold the boat."
    },
    shortAnswerIds: ["q2_11", "q2_12", "q2_13", "q2_14", "q2_15"],
    totalQuestions: 19
  },
  quizSet3: {
    title: "Revision Set 3: Application & Uses",
    formId: "quizFormSet3", resultsId: "resultsSet3",
    mcq: { q3_1: "C", q3_2: "B", q3_3: "C", q3_4: "B", q3_5: "C" },
    fib: { q3_6: ["float"], q3_7: ["fabric","fabrics"], q3_8: ["strong"], q3_9: ["strong"], q3_10: ["transparent","clear"]},
    match: { q3_16_window: "D", q3_16_tyre: "B", q3_16_tshirt: "C", q3_16_coins: "A" },
    shortAnswer: {
      q3_11: "Fabric is good for T-shirts because it's soft (comfortable to wear) and flexible (allows movement).",
      q3_12: "Strength would be most important for a bridge, so it can support heavy vehicles and people without collapsing.",
      q3_13: "Plastic and fabric are less likely to break into sharp pieces if dropped, making them safer than glass or ceramic for young children.",
      q3_14: "An umbrella needs to be waterproof to keep rain from passing through and getting you wet.",
      q3_15: "For a rope swing, strength (so it doesn't break when someone swings on it) and flexibility (so it can swing smoothly) are important."
    },
    shortAnswerIds: ["q3_11", "q3_12", "q3_13", "q3_14", "q3_15"],
    totalQuestions: 19
  }
};

let currentQuizSetId = 'quizSet1';
const GEMINI_MODEL_NAME = "gemini-1.5-flash-latest";

function getFeedbackElement(id) { const el = document.getElementById(id); if (!el) console.error(`FB el ${id} not found!`); return el; }
function setFeedback(feedbackEl, message, type) { if (!feedbackEl) return; feedbackEl.innerHTML = message; feedbackEl.className = `feedback ${type}`; }

function showQuiz(quizId) {
  currentQuizSetId = quizId;
  document.querySelectorAll('.quiz-section').forEach(section => section.classList.remove('active'));
  document.getElementById(quizId).classList.add('active');
  document.querySelectorAll('.navigation-buttons button').forEach(btn => btn.classList.remove('active-nav'));
  document.getElementById(`navBtn${quizId.charAt(0).toUpperCase()}${quizId.slice(1).replace('quizS','S')}`).classList.add('active-nav');
  for (const setId in allQuizData) {
    const resultsEl = getFeedbackElement(allQuizData[setId].resultsId);
    if (resultsEl) resultsEl.innerHTML = '';
  }
}

async function evaluateMultipleShortAnswersWithGemini(shortAnswerData) {
  if (typeof geminiAPIKey === 'undefined' || !geminiAPIKey || geminiAPIKey === "YOUR_GEMINI_API_KEY_HERE" || geminiAPIKey === "__GEMINI_API_KEY_PLACEHOLDER__") {
    console.error("Gemini API Key is not defined or is a placeholder.");
    return shortAnswerData.map(() => "Error: API Key not configured.");
  }
  const GEMINI_API_ENDPOINT = `https://generativelanguage.googleapis.com/v1beta/models/${GEMINI_MODEL_NAME}:generateContent?key=${geminiAPIKey}`;
  let promptContent = `You are an AI grading assistant for a P3 science quiz. Evaluate each student's answer against its model answer. For EACH question, your response MUST be: QID:[question_id] Result:[Correct.|Incorrect.] Explanation:[Your P3-friendly explanation]||END_Q||. Example: QID:q1_11 Result:Correct. Explanation:Good.||END_Q||. No text before first QID or after last ||END_Q||. Questions:`;
  shortAnswerData.forEach(item => { promptContent += `\nQID: ${item.id}\nStudent: "${item.userInput}"\nModel: "${item.modelAnswer}"\n---\n`; });
  promptContent += "Provide evaluations in the specified format.";
  try {
    const response = await fetch(GEMINI_API_ENDPOINT, {
      method: "POST", headers: {"Content-Type": "application/json"},
      body: JSON.stringify({contents: [{ parts: [{ text: promptContent }] }], generationConfig: {temperature: 0.2, maxOutputTokens: 1500}})
    });
    if (!response.ok) {
      const err = await response.json().catch(() => ({error:{message:"Unknown API error"}}));
      return shortAnswerData.map(item => `QID:${item.id} Result:Incorrect. Explanation:(API Error: ${err.error.message||response.status})||END_Q||`);
    }
    const data = await response.json();
    if (data.candidates?.[0]?.finishReason === "SAFETY") return shortAnswerData.map(item => `QID:${item.id} Result:Incorrect. Explanation:(API: Blocked by safety.)||END_Q||`);
    if (!data.candidates?.[0]?.content?.parts?.[0]?.text) return shortAnswerData.map(item => `QID:${item.id} Result:Incorrect. Explanation:(API Error: Malformed response.)||END_Q||`);
    const aiFullResponse = data.candidates[0].content.parts[0].text;
    const evaluations = {};
    aiFullResponse.split("||END_Q||").forEach(part => {
      if (!part.trim()) return;
      const qidMatch = part.match(/QID:([\w_]+)/);
      const resultMatch = part.match(/Result:(Correct\.|Incorrect\.)/);
      const explanationMatch = part.match(/Explanation:([\s\S]*)/);
      if (qidMatch &&resultMatch &&explanationMatch) evaluations[qidMatch[1]] = `${resultMatch[1]} ${explanationMatch[1].trim()}`;
      else if (qidMatch && !evaluations[qidMatch[1]]) evaluations[qidMatch[1]] = "Incorrect. AI format error.";
    });
    return shortAnswerData.map(item => evaluations[item.id] || "Incorrect. AI no feedback/format error.");
  } catch (error) {
    return shortAnswerData.map(item => `QID:${item.id} Result:Incorrect. Explanation:(API Error: ${error.message})||END_Q||`);
  }
}

async function submitQuiz(quizSetKey) {
  const quizDef = allQuizData[quizSetKey];
  if (!quizDef) { console.error("Invalid quizSetKey:", quizSetKey); return; }
  let score = 0, shortAnswersCorrect = 0;
  const form = document.getElementById(quizDef.formId);
  const resultsDiv = getFeedbackElement(quizDef.resultsId);
  form.querySelectorAll('.feedback').forEach(el => { el.innerHTML = ''; el.className = 'feedback'; });
  setFeedback(resultsDiv, "Processing...", "info");

  Object.keys(quizDef.mcq).forEach(qName => {
    const fbEl = getFeedbackElement(`f${qName.substring(1)}`);
    const sel = form.querySelector(`input[name="${qName}"]:checked`);
    if (sel?.value === quizDef.mcq[qName]) { score++; setFeedback(fbEl, "Correct!", "correct"); }
    else { setFeedback(fbEl, `Incorrect. Ans: ${quizDef.mcq[qName]}`, "incorrect"); }
  });
  Object.keys(quizDef.fib).forEach(qName => {
    const fbEl = getFeedbackElement(`f${qName.substring(1)}`);
    const uIn = form.querySelector(`input[name="${qName}"]`).value.trim().toLowerCase();
    const corr = quizDef.fib[qName];
    const isCorr = Array.isArray(corr) ? corr.includes(uIn) : uIn === corr;
    if (isCorr && uIn) { score++; setFeedback(fbEl, "Correct!", "correct"); }
    else if (uIn) { setFeedback(fbEl, `Incorrect. Ans: ${Array.isArray(corr)?corr.join('/'):corr}`, "incorrect"); }
    else { setFeedback(fbEl, "No answer.", "incorrect"); }
  });
  let matchScore = 0;
  const matchPrefix = Object.keys(quizDef.match)[0]?.split('_').slice(0,2).join('_');
  if (matchPrefix) {
      const matchFbContainer = getFeedbackElement(`f${matchPrefix.substring(1)}`);
      if (matchFbContainer) matchFbContainer.innerHTML = '';
      Object.keys(quizDef.match).forEach(itemName => {
          const selEl = form.querySelector(`select[name="${itemName}"]`);
          const itemDispName = itemName.split('_').pop();
          const itemFbDiv = document.createElement('div');
          if (selEl?.value === quizDef.match[itemName]) {
              matchScore++; itemFbDiv.textContent = `${itemDispName}: Correct!`; itemFbDiv.className = "feedback correct";
          } else {
              itemFbDiv.textContent = `${itemDispName}: Incorrect. Ans: ${quizDef.match[itemName]}`; itemFbDiv.className = "feedback incorrect";
          }
          if (matchFbContainer && selEl) matchFbContainer.appendChild(itemFbDiv);
      });
      score += matchScore;
  }

  const autoGradedScore = score;
  const autoGradedTotal = (Object.keys(quizDef.mcq).length) + (Object.keys(quizDef.fib).length) + (Object.keys(quizDef.match).length / (Object.keys(quizDef.match)[0]?.split('_').length > 2 ? 1:0) || Object.keys(quizDef.match).length ); // Simpler way to count match items as 1 question if grouped by prefix. A bit complex here, better to store counts.
  // For simplicity, assuming match is 4 points (1 per item)
  const totalMatchPoints = Object.keys(quizDef.match).length > 0 ? 4 : 0; // Or dynamically count if needed
  const autoGradedTotalForDisplay = (Object.keys(quizDef.mcq).length) + (Object.keys(quizDef.fib).length) + totalMatchPoints;


  setFeedback(resultsDiv, `Auto-graded: ${autoGradedScore}/${autoGradedTotalForDisplay}. Evaluating short answers...`, "info");
  const shortAnswersToEval = [];
  quizDef.shortAnswerIds.forEach(qId => {
    const uIn = form.querySelector(`input[name="${qId}"]`).value.trim();
    if (uIn) shortAnswersToEval.push({id: qId, userInput: uIn, modelAnswer: quizDef.shortAnswer[qId]});
    else setFeedback(getFeedbackElement(`f${qId.substring(1)}`), "No answer.", "incorrect");
  });

  if (shortAnswersToEval.length > 0) {
    const aiEvals = await evaluateMultipleShortAnswersWithGemini(shortAnswersToEval);
    aiEvals.forEach((resTxt) => {
      const qData = shortAnswersToEval.find(sa => resTxt.startsWith(`QID:${sa.id}`)) || shortAnswersToEval[aiEvals.indexOf(resTxt)];
      const fbEl = getFeedbackElement(`f${qData.id.substring(1)}`);
      const dispRes = resTxt.replace(/QID:[\w_]+ Result:/, "Result:");
      if (resTxt.toLowerCase().includes("correct.")) { shortAnswersCorrect++; setFeedback(fbEl, dispRes, "correct");}
      else { setFeedback(fbEl, dispRes, "incorrect");}
    });
  }
  score += shortAnswersCorrect;
  setFeedback(resultsDiv, `Final Score for ${quizDef.title}: ${score} / ${quizDef.totalQuestions}`, "info");
}

document.addEventListener('DOMContentLoaded', () => {
  if (typeof geminiAPIKey==='undefined' || geminiAPIKey==="__GEMINI_API_KEY_PLACEHOLDER__") {
    const resDiv1 = getFeedbackElement(allQuizData.quizSet1.resultsId);
    let warnMsg = "Warning: API Key placeholder. ";
    if (window.location.hostname.includes('github.io')) warnMsg += "Action might not have processed config.js.";
    else warnMsg += "Expected locally. AI grading won't work.";
    if(resDiv1) setFeedback(resDiv1, warnMsg, "incorrect");
  }
  showQuiz('quizSet1');
});
</script>
</body>
</html>
